import Player from '../../core/Player.js';

export class ProfileSystem {
    // ... Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
    
    async changeName(player, args, senderId) {
        // ğŸ†• Ø§Ù„ØªØµØ­ÙŠØ­: Ø§Ø³ØªØ®Ø¯Ø§Ù… ADMIN_PSID
        const ADMIN_PSID = process.env.ADMIN_PSID;
        
        if (senderId !== ADMIN_PSID) {
            return 'âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø±.';
        }

        let newName = args.join(' ').trim();
        
        if (!newName) {
            return 'ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯. Ù…Ø«Ø§Ù„: ØªØºÙŠÙŠØ±_Ø§Ø³Ù… JohnDoe';
        }

        let targetPlayer = player;
        
        if (args.length > 1 && args[0].length > 10 && !isNaN(args[0])) { 
            const targetId = args[0];
            targetPlayer = await Player.findOne({ userId: targetId });
            
            if (!targetPlayer) {
                return `âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù„Ø§Ø¹Ø¨ Ø¨Ø§Ù„Ù…Ø¹Ø±Ù: ${targetId}`;
            }
            newName = args.slice(1).join(' ').trim();
        }

        if (!newName) {
            return 'ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ø±Ù (Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØºÙŠØ± Ø§Ø³Ù… Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø±).';
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø§Ø³Ù…
        if (newName.length < 3 || newName.length > 9) {
            return 'âŒ Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 3 Ø¥Ù„Ù‰ 9 Ø£Ø­Ø±Ù.';
        }

        if (!/^[a-zA-Z]+$/.test(newName)) {
            return 'âŒ Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙÙ‚Ø·.';
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ø³Ù…
        const existingPlayer = await Player.findOne({ 
            name: new RegExp(`^${newName}$`, 'i'),
            userId: { $ne: targetPlayer.userId }
        });

        if (existingPlayer) {
            return 'âŒ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø¢Ø®Ø±.';
        }

        const oldName = targetPlayer.name;
        targetPlayer.name = newName;

        console.log(`âœ… ØªÙ… ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ ${oldName} Ø¥Ù„Ù‰ ${newName}`);
        
        return `âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ ${oldName} Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰: **${newName}**`;
    }
        }
